<!DOCTYPE html>
<html>
<head>

<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="">
<meta name="author" content="">

<link rel="stylesheet" href="./static/semantic/css/semantic.min.css"/>
<link href="./static/asset/prettify.css" rel="stylesheet">
<link href="./static/toc/toc.css" rel="stylesheet">
<link rel="stylesheet" href="./static/parm.css"/>
<link rel="stylesheet" href="./static/asset/sons-of-obsidian.css"/>
<link rel="stylesheet" href="./static/ui.totop.css"/>

<title>均衡器 - 信号完整性工程师笔记</title>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX", "output/HTML-CSS"],
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
      processEscapes: true
    },
    "HTML-CSS": { availableFonts: ["TeX"] }
  });
</script>
<script type="text/javascript"
  src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
</head>
<body>



<!-- Navbar
================================================== -->
<div class="navbar">
  <div class="ui small secondary inverted borderless menu">
    
    <a class="active item" href="./index.html">Home</a>
    
    <div class="right menu">
      
        
<div class="item">
  <div class="ui icon input">
    <form id="searchform">
    <input name="q" type="text" placeholder="Search...">
    </form>
  </div>
</div>

      
      <div class="ui dropdown item">
        Select Languages <i class="icon dropdown"></i>
        <div class="menu">
          <a class="item language" href="../en/index.html" data-lang="en">English</a>
          <a class="item language" href="../zh_CN/index.html" data-lang="zh_CN">中文</a>
        </div>
      </div>
    </div>
  </div>
</div>


<div class="ui divided grid">
    <div class="four wide column" id="side-bar">
        <div id="toc" class="content"></div>
    </div> 
    
    <div class="twelve wide column" id="markdown-content">
    
        <div class="chapter-prev chapter-top pull-left">
    <a prev-chapter href="./prbs.html"><i class="fa fa-long-arrow-left"></i> PRBS算法</a>
</div>

        
        <h1 id="title_1">均衡器<a class="anchor" href="#title_1">&para;</a></h1>
<h2 id="title_1-1">预加重(Pre-emphasis)<a class="anchor" href="#title_1-1">&para;</a></h2>
<p>几个概念先了解一下</p>
<h3 id="title_1-1-1">Pre-emphasis vs De-emphasis<a class="anchor" href="#title_1-1-1">&para;</a></h3>
<p>在FM通信系统中，Pre-emphasis表示提高高频分量的增益， De-emphasis系统中表示 衰减高频分量增益。如下图，可以分别看成是高通和低通滤波器，而且是相互抵消的关系<sup id="fnref-silist"><a href="#fn-silist" class="footnote-rel inner">1</a></sup>。</p>
<p><img src="../images/FM_pre-emphasis.png"/>
</p>
<p>但在高速数字通信系统中，二者没有本质的区别，唯一的区别是系数的绝对值之和 是否比1大，比1大就是Pre-emphasis，意味着peak-peak swing比原先的波形大， 比1小就是De-emphasis意味着peak-peak swing比原先的波形小。</p>
<p>下图假定数据速率为5Gbps,其Nyquist频率为2.5GHz. 2者的曲线没有本质区别， 之后一个垂直方向的偏差。</p>
<ul>
<li>红色的曲线系数为[1.5,-0.5],其DC增益为0dB，但是Nyquist频率处增益为6dB</li>
<li>蓝色色的曲线系数为[0.75,-0.25],其DC增益为-6dB，但是Nyquist频率处增益为0dB</li>
</ul>
<p><img src="../images/6dB_FR_compare.png"/>
</p>
<p>其Python源代码如下：</p>
<pre class="prettyprint linenums"><code>import numpy as np
import matplotlib.pyplot as plt
from scipy import signal

data_rate = 5 #Gbps
taps = [0.75,-0.25]

taps2 = np.array( [0.75,-0.25])*2

w,h = signal.freqz(taps)

plt.plot(w/np.pi*2.5, 20 * np.log10(abs(h)), 'b',label="de-emphasis")

w,h = signal.freqz(taps2)

plt.plot(w/np.pi*2.5, 20 * np.log10(abs(h)), 'r',label="pre-emphasis")
plt.ylabel('Amplitude [dB]', color='b')
plt.xlabel('Frequency (GHz)')
plt.grid()
plt.legend(loc="best")

plt.show()</code></pre>

<h3 id="title_1-1-2">Pre-emphasis几种不同的名称<a class="anchor" href="#title_1-1-2">&para;</a></h3>
<div class="ui info message">
<p>Pre-emphasis == FFE(Feed forward equalizer) == FIR filter == Convolve</p>

</div>
<p>这几个概念完全等同，Pre-emphasis本质就是FIR滤波，也称为FFE前方反馈滤波器， 在DSP算法中，可以用卷积实现。</p>
<div class="ui info message">
<p>Pre-emphasis taps = coefficient</p>

</div>
<p>这个容易理解，tap就是FIR滤波器的系数。</p>
<p>Pre cursor 和 post cursor的区别，是tap相对于main tap的位置。</p>
<p>以2个tap为例，比如系数为[-0.25,0.75]，表示1个tap的pre cursor，值为-0.25。 系数为[0.75，-0.25]，表示1个tap的post cursor，值为-0.25。</p>
<p>以三个tap的系数[-0.131,0.595,-0.274]， 最大的0.595为main tap, -0.131为pre cursor -0.274为post cursor</p>
<p>下图表示出了channel response中cursor的位置</p>
<p><img src="../images/pre_vs_post_cursor.PNG"/>
</p>
<h3 id="title_1-1-3">dB和tap之间的关系<a class="anchor" href="#title_1-1-3">&para;</a></h3>
<p>这个也是很容易混淆的概念，很多业界标准如PCI-E GEN2中规定了-3.5dB,6dB 均衡器。 下图是USB3.0标准中关于EQ系数和dB之间的关系。</p>
<p>从图中不难看出:</p>
<ol>
<li>de-emphasis是受post cursor控制</li>
<li>pre-shoot 是受pre cursor控制</li>
<li>需要长 <strong>0</strong> 或者 长 <strong>1</strong> pattern才能看出de-emphasis/pre-shoot效应</li>
</ol>
<p><img src="../images/dB_EQ_relation.PNG"/>
</p>
<p>下面可以做一个简单的计算，如果tap系数为[0.75,-0.25],这表明$C_{-1}=0$, $C_{0}=0.75$,$C_{1}=-0.25$ 带入公式得到:</p>
<p>$$ deemphasis = 20log_{10}\left(\frac{C_{-1}+C_0+C_1}{C_{-1}+C_0-C_1}\right) = 20log_{10}\left(\frac{0+0.75-0.25}{0+0.75-0.25}\right) =-6dB $$</p>
<p>下面为pre-emphasis代码Python实现的方法演示，其中用到了卷积来实现。</p>
<pre class="prettyprint linenums"><code>import numpy as np
import matplotlib.pyplot as plt


pattern = [-1,-1,-1,-1,-1,1,1,1,1,1,-1,-1,-1,-1,-1,1,1,1,1,1,-1,1,-1,1,-1,1,-1,1,-1,1,-1,1,-1,1,-1,1]
taps_pre = [-0.25,0.75]
taps_post = [0.75,-0.25]

sa_per_ui = 10

wave_orig = np.repeat(pattern,sa_per_ui)

wave_pre = np.zeros((len(pattern)+len(taps_pre)-1)*sa_per_ui)
for i in range(sa_per_ui):
    wave_pre[i::sa_per_ui] = np.convolve(wave_orig[::sa_per_ui],taps_pre)

wave_post = np.zeros((len(pattern)+len(taps_post)-1)*sa_per_ui)
for i in range(sa_per_ui):
    wave_post[i::sa_per_ui] = np.convolve(wave_orig[::sa_per_ui],taps_post)


plt.subplot(311)
plt.plot(wave_orig,label="orginal")
plt.ylim([-1.2,1.2])
plt.legend()
plt.subplot(312)
plt.plot(wave_pre,label="pre cursor\ntaps=[-0.25,0.75]")
plt.ylim([-1.2,1.2])
plt.legend()
plt.subplot(313)
plt.plot(wave_post,label="post cursor\ntaps=[0.75,-0.25]")
plt.ylim([-1.2,1.2])
plt.legend()
plt.show()</code></pre>

<p>下图是代码输出的图片</p>
<p><img src="../images/preemphasis.png" title="pre-emphasis demo"/>
</p>
<div class="footnotes"><ol>
<li id="fn-silist">
<p> <a class="outter" href="https://www.freelists.org/post/si-list/Whats-different-between-Preemphasis-and-Deemphasis">https://www.freelists.org/post/si-list/Whats-different-between-Preemphasis-and-Deemphasis</a></p>

<a class="footnote-backref inner" href="#fnref-silist">&#8617;</a>

</li>
</ol></div>
        
        <div class="ui blue inverted small label">
            <i class="icon download"></i><a href="./eq.md">View Source</a>
        </div>
        <div class="ui blue inverted small label">
            <i class="icon help link" data-html="<b>&larr;</b> Prev Chapter <b>&rarr;</b> Next Chapter<br/><b>h</b> Index Page"></i>
        </div>
        
        
    </div>
</div>

<div class="ui page grid">
    <div class="column">
    <!-- disqus -->
    
    </div>
</div>

<div class="ui page grid" id="footer">
    <div class="column">
    
<p>Designed by Limodou, Copyright 2017, Niu Li</p>
<p>CSS framework <a href="https://github.com/twitter/bootstrap">Bootstrap</a>, Markdown parser lib <a href="https://github.com/limodou/par">Par</a> and this page is created by <a href="https://github.com/limodou/parm">Parm</a> tool.</p>

    </div>
</div>


<script>
var relpath = '.';
</script>

<script type="text/javascript" src="./static/jquery-1.7.2.min.js"></script>
<script type="text/javascript" src="./static/semantic/javascript/semantic.min.js"></script>
<script src="./static/asset/prettify.js"></script>
<script src="./static/toc/toc.js"></script>
<script src="./static/jquery.ui.totop.js"></script>
<script src="./static/jquery.hotkeys.js"></script>
<script src="./static/jquery.sticky-kit.min.js"></script>
<script src="./static/docs.js"></script>
<script src="./static/comment.js"></script>




    
<script type="text/javascript">
$(function(){
    var form = $('#searchform');
    form.submit(function(e){
        e.preventDefault();
        var wq=$('input[name="q"]').val();
        var link="http://www.google.com/search?q=site:leeooox.github.io/avs/zh_CN "+wq;
        window.open(link);

    });
});
</script>



<script>
$(function(){
    $('.navbar .ui.dropdown').dropdown({
        on: 'hover'
    });
    $('a.language').on('click', function(){
        $.cookie('language', $(this).data('lang'), { expires: 360, path: '/' });
        window.location.href = "./../"+$(this).data('lang')+'/index.html';
    });
});
</script>
</body>
</html>
